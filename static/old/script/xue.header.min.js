/*
 * XESUI 
 * Copyright 2013 xueersi.com All rights reserved.
 *
 * @description 
 *
 * @author Marco (marco@xesui.com)
 * @modify 2013-06-26 21:21:50
 * @version $Id$
 * 
 * @links http://xesui.com
 */


/**
 * @name xesui.js
 * @description 声明 xue 包：增加别名“X”
 * 
 * @module 
 * @submodule 
 * @main 
 * @class 
 * @constructor 
 * @static 
 */

var X, xue;
xue = xue || function (expr, fn) {
    
    return xue.dom ? xue.dom(expr, fn) : {};
    
};
X = xue;
window.xue = xue;

xue.version = '10419';

xue.id = 'xesui';
xue.guid = '$XESUI$';
xue.team = {
	Marco  : 'Marco@xesui.com',
	Alex   : 'Alex@xesui.com',
	Sam    : 'Sam@xesui.com',
	Star   : 'W.Star@xesui.com'
};

xue.expr = '';
xue.host = window.location.host;
var _host = xue.host.split('.');
if(_host.length > 2){
    xue.subdomain = _host[0];
    xue.domain = _host[1];
}
/* ========================== 公共方法 =========================== */
if(xue.subdomain && xue.subdomain == 'bbs'){
    jQuery.noConflict();
}
xue.random = function (min, max, len) {

};

/**
 * 返回时间数
 * @param  {Date} date 指定日期 2012-05-23
 * @return {number}      返回以毫秒为单位的时间
 */
xue.getTime = function (date) {
	var d = date ? new Date(date) : new Date();
	return d.getTime();
};
/**
 * @name xue.extend.js
 * @description 扩展
 * 
 * @module 
 * @submodule 
 * @main 
 * @class 
 * @constructor 
 * @static 
 */

xue.extend = xue.extend || function(className, fn, constructor){
	var _name = className;

	var _class = xue[_name] = xue[_name] || fn;

	return this;
};

// var isIE=!!window.ActiveXObject;
// xue.ie6 = isIE&&!window.XMLHttpRequest;
// xue.ie6 = !-[1,]&&!window.XMLHttpRequest;

xue.browser = xue.browser || {};
xue.browser.uga = navigator.userAgent.toLowerCase();

xue.browser.mozilla = /firefox/.test(xue.browser.uga);
xue.browser.webkit = /webkit/.test(xue.browser.uga);
xue.browser.opera = /opera/.test(xue.browser.uga);
xue.browser.msie = /msie/.test(xue.browser.uga);
xue.browser.safari = /safari/.test(xue.browser.uga);
xue.browser.camino = /camino/.test(xue.browser.uga);
xue.browser.gecko = /gecko/.test(xue.browser.uga);

xue.check = xue.check || {};
xue.check.isIE6 = !-[1,]&&!window.XMLHttpRequest;
xue.check.isIE9 = xue.browser.uga.indexOf("msie 9.0")>0;
xue.check.isFirefox = xue.browser.mozilla;

xue.isIE = xue.browser.msie;
xue.isIE6 = xue.check.isIE6;
xue.isIE7 = window.XMLHttpRequest ? true : false;
xue.isIE8 = window.postMessage ? true : false;
xue.isIE9 = xue.check.isIE9;
xue.isIE10 = (document.documentMode == 10) ? true : false;
xue.isFirefox = xue.check.isFirefox;

xue.ajaxCheck = xue.ajaxCheck || {};


xue.ajaxCheck.HTML = function( str, notips ){
	if(!str){
		// xue.alert('数据读取错误……');
		return false; 
	}
	var _str = jQuery.trim(str);
	if(_str.substr(0,1) == '<'){
		return _str;
	}else if(_str.substr(0,4) == 'http' || _str.substr(0,1) == '/'){
		window.location.href = _str;
		return false;
	}else{
		if(notips){
			return false;
		}else{
        	alert(_str);			
		}
        return false;
	}

};

xue.ajaxCheck.JSON = function( d ){
	if(!d){ 
		// xue.alert('数据读取错误……');
		return false; 
	}
	var tp = d.sign, msg = d.msg;
	if(tp === 0){
		alert(msg);
		return false;
	}
	if(tp === 2){
		window.location.href = d.msg;
	}
	if(tp === 1){
		return msg;
	}
};

xue.ajaxCheck.json = xue.ajaxCheck.JSON;
xue.ajaxCheck.html = xue.ajaxCheck.HTML;


/**
 * 异步加载JS/CSS文件
 * @param  {[type]}   url [description]
 * @param  {Function} fn  [description]
 * @return {[type]}       [description]
 */
xue.load = xue.load || function( url, fn ){
	if(!url){ return xue; }
	
	var tp = xue.load._checkType(url);
	var callback = null;

	jQuery.each(arguments, function(){
		if(typeof this === 'function'){
			callback = this;
		}else{
			return this;
		}
	});

	xue.load.callback = callback;

	if(xue.load.isExist(url)){
		// xue.alert('文件已存在');
		if(callback){
			callback();
		}
		return xue;
	}
	if(tp){
		xue.load[tp](url);
	}

	return xue;
};

(function(){

	var load = xue.load;

	load.files = {};

	// 回调函数
	load.callback = null;
	load.type = null;
	load.url = null;

	// 加载外部js文件
	load.js = function( url ){
	
		var _call = load.callback ? load.callback : function(){};

		// 检测文件是否存在，不存在则加载，否则直接返回callback
		if(!this.isExist(url)) {
			var file = document.createElement('script');
			file.type = 'text/javascript';

			if(file.readyState) {// IE
				file.onreadystatechange = function() {
					if(file.readyState == 'loaded' || file.readyState == 'complete') {
						file.onreadystatechange = null;
						_call(true);
					}
				};
			} else {
				file.onload = function() { _call(true); };
			}
			file.src = url;
			document.getElementsByTagName('head')[0].appendChild(file);
		} else {
			_call(false);
		}

		return this;
	};

	// 加载外部css文件
	load.css = function( url ){
		var _call = load.callback ? load.callback : function(){};

		// 检测文件是否存在，不存在则加载，否则直接返回callback
		if(!this.isExist(url)) {
			var file = document.createElement('link');
			file.type = 'text/css';
			file.rel = 'stylesheet';

			if(file.readyState) {// IE
				file.onreadystatechange = function() {
					if(file.readyState == 'loaded' || file.readyState == 'complete') {
						file.onreadystatechange = null;
						_call(true);
					}
				};
			} else {
				file.onload = function() { _call(true); };
			}
			file.href = url;
			document.getElementsByTagName('head')[0].appendChild(file);
		} else {
			_call(false);
		}
		return this;
	};

	// 往页面里直接写入script代码
	load.script = function( code ){
		var script = document.createElement('script');
        script.type = 'text/javascript';
        try{
            script.appendChild(document.createTextNode(code));
        }catch(ex){
            script.text = code;
        }
        document.body.appendChild(script);
        return this;
	};

	// 往页面里直接写入style样式
	load.style = function( code ){
		var style = document.createElement('style');
        style.type = 'text/css';
        try{
            style.appendChild(document.createTextNode(code));
        }catch(ex){
            style.styleSheet.cssText = code;
        }
        document.getElementsByTagName('head')[0].appendChild(style);
        return this;
	};

	// 根据文件路径，判断是js还是css，返回文件类型
	load._checkType = function( url ){
		if(!url){ return; }

		var tp = (url.indexOf('.js') > -1 )? 'js' : (url.indexOf('.css') > -1 ? 'css' : null);
		return tp;
	};

	//检查文件是否存在
	load.isExist = function( url ){
		if(!url){ return; }
		var tp = load._checkType(url);
		if(!tp){ xue.alert('文件格式不对'); return; }

		var tag = tp == 'js' ? 'script' : 'link';
		var src = tp == 'js' ? 'src' : 'href';
		var _files = document.getElementsByTagName(tag);
		for(var i = 0, len = _files.length; i < len; i++) {
			if(_files[i][src].indexOf(url) > -1) {
				return true;
			}
		}
		return false;
	};

})();


/**
 * 加载script文件
 * @param {String} 		url
 * @param {sting}		place: 加载文件的位置：head or body
 * @param {Function}	callback
 */
xue.loader = xue.loader || function(url, callback, isBody) {

	// 如果没有url则返回；
	if(!url) { return; }

	var _call = callback ? callback : function(){};

    // 增加setTimeout，解决在loadScript与页面内容之间如果还有script标签的话，一样会阻塞内容下载的问题：http://www.58lou.com/separticle.php?artid=194
    setTimeout(function(){

        // 声明一个“检查文件是否已经存在”的函数，返回布尔值；
        var _isLoad = function() {
            var _scripts = document.getElementsByTagName('script');
            for(var i = 0, len = _scripts.length; i < len; i++) {
                if(_scripts[i].src.indexOf(url) > -1) {
                    return true;
                }
            }
            return false;
        }();

        // 检测文件是否存在，不存在则加载，否则直接返回callback
        if(!_isLoad) {
            var script = document.createElement('script');
            script.async="async";  
            script.type = 'text/javascript';

            if(script.readyState) {// IE
                script.onreadystatechange = function() {
                    if(script.readyState == 'loaded' || script.readyState == 'complete') {
                        script.onreadystatechange = null;
                        _call(true);
                    }
                };
            } else {
                script.onload = function() { _call(true); };
            }
            script.src = url + '?' + xue.version;
            // 文件加入的位置：如果 isBody = true 则在body后面追加，否则追加到head后面
            var _place = (isBody) ? 'body' : 'head';
            document.getElementsByTagName(_place)[0].appendChild(script);
        } else {
            _call(false);
        }
        return this;
        
    }, 0);

};

/**
 * 增加对JSON数据的序列化方法，
 * 主要用于IE6、7不支持JSON对象的浏览器
 */
xue.json = xue.json || {};

xue.json.stringify = function (obj) {
    //如果是IE8+ 浏览器(ff,chrome,safari都支持JSON对象)，使用JSON.stringify()来序列化
    if (window.JSON) {
        return JSON.stringify(obj);
    }
    var t = typeof (obj);
    if (t != "object" || obj === null) {
        // simple data type
        if (t == "string") obj = '"' + obj + '"';
        return String(obj);
    } else {
        // recurse array or object
        var n, v, json = [], arr = (obj && obj.constructor == Array);

        // fix.
        var self = arguments.callee;

        for (n in obj) {
            v = obj[n];
            t = typeof(v);
            if (obj.hasOwnProperty(n)) {
                if (t == "string") v = '"' + v + '"'; else if (t == "object" && v !== null)
                    // v = jQuery.stringify(v);
                    v = self(v);
                json.push((arr ? "" : '"' + n + '":') + String(v));
            }
        }
        return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
    }
};
/*
    * method : parse(json string)
    * return : js原生值
*/   
xue.json.parse = function (jsonString) {
    if (window.JSON) {
        return window.JSON.parse(s);
    }
    //使用到了jquery的parseJSON(s)方法
    return jQuery.parseJSON(jsonString);
};

xue.JSON = xue.json;

/**
 * 模块添加
 * @param  {string}   moduleName  模块名称
 * @param  {Function} callback    回调函数
 * @param  {Boolean}  isQueue  	  是否加入队列：在队列中的文件逐个加载（非异步）
 * @return {[type]}         	  加载完成后返回xue对象，可直接链式调用，
 *
 * @example:
 *
 * 			xue.add('pages', function(){
 * 			
				// 将分页扩展到xue对象下；
				xue.extend('pages', ui.pages);

 * 			}).use('pages', function(){
 * 				xue.pages.config({
 * 					...
 * 				});
 * 			});
 *
 * 还没想好：如何让链式调用需要放在异步加载成功之后再执行；
 */
// xue.add = xue.add || function(moduleName, callback, isQueue){};

/**
 * 模块调用方法
 *
 * 
 * @param  {string}   moduleName 模块名称
 * @param  {Function} callback   模块加载完成的回调，回调函数中会返回模块对象，方便内部调用
 * @param  {Boolean}  isQueue  	 是否加入队列：在队列中的文件逐个加载（非异步）
 * @param  {date}     timeout    延时加载的时间以毫秒为单位
 * 
 * @return {[type]}              不管模块是否加载成功，都会返回跟对象，便于链式调用 ; 
 *                               链式调用与模块的加载情况是异步的，没有依赖关系，所以在链式调用中不能确保能够调用到模块中的方法
 * @example
 
	  	window.onload = (function(){
	  			
				xue.use('pages', function(module){
					// 根据模块名称进行调用
					xue.pages.config({
						pages : 22,
						current : 1
					}).go(3);

					// 根据返回的对象进行调用
					module('page2').config({
						pages: 10,
						current: 3
					});
				}, true, 1000).test();
		});
 */
xue.use = xue.use || function(moduleName, callback, isQuequ, timeout){ 
	
	/**
	 * 声明内部变量，用于存放传入的参数
	 *
	 * n  [moduleName] : 模块名称
	 * f  [callback]   : 回调函数
	 * q  [isQueue]    : 是否加入队列
	 * t  [timeout]    : 延迟执行回调的时间
	 * tp [typeof]     : 存放参数类型
	 * 
	 * @type {[type]}
	 */
	var n = null, f = false, q = false, t = false, tp = null;

	/**
	 * 循环参数对象
	 *
	 * 根据参数的类型存入相应的变量中
	 * 如果类型不匹配则返回变量的原始值，防止变量被重复赋值
	 */
	jQuery.each(arguments, function(k, v){
		tp = typeof v;
		n = (tp === 'string')   ? v : n;
		f = (tp === 'function') ? v : f;
		q = (tp === 'boolean')  ? v : q;
		t = (tp === 'number')   ? v : t;
	});

	// 如果没有传入模块名称，则直接返回xue对象，并提示错误；
	if(n === null || n === ''){
		alert('方法调用错误，没有模块名称');
		return xue;
	}

	/**
	 * 回调函数
	 * @return {object}   xue[n]  返回模块对象
	 */
	var callback = function(){ if(f){ return f(xue[n]); } };

	/**
	 * 模块状态判断
	 *
	 * 如果已经存在，则直接调用回调函数
	 * 如果不存在，则通过异步加载模块文件，
	 * 文件加载成功之后根据传入的timeout情况来确定是否延时触发回调函数
	 */
	if(xue[n]){
		callback();
	}else{
		// 调用异步加载方法，默认线上JS模块文件放到 sript/下面，文件名：xue.[模块名].min.js
		xue.loader('http://js04.xesimg.com/xue.' + n + '.min.js', function(){
			if(t){
				setTimeout(function(){
					callback();
				}, t);
			}else{
				callback();
			}
		});	
		
	}
	return this;
};
/**
 * 延时事件
 */
xue.eventDelay = function(dom, fn, timer){
	this.timer = timer || 1000;
	this.interval = '';
};

xue.eventDelay.start = function(dom, fn){};

xue.eventDelay.clear = function(dom, fn){};

xue.delay = xue.eventDelay;

xue.test = function(d){
	// console.log(d);
};

xue.log = xue.log || function(msg){
	if(window.console){
		console.log(msg);
	}else{
		alert(msg);
	}
	return xue;
};

/**
 * @name placeHolder
 * @class 跨浏览器placeHolder,对于不支持原生placeHolder的浏览器，通过value或插入span元素两种方案模拟
 * @param {Object} obj 要应用placeHolder的表单元素对象
 * @param {Boolean} span 是否采用悬浮的span元素方式来模拟placeHolder，默认值false,默认使用value方式模拟
 */
xue.placeholder = function(obj, span) {
    if (!obj.getAttribute('placeholder')) return;
    var imitateMode = span===true?true:false;
    var supportPlaceholder = 'placeholder' in document.createElement('input');
    if (!supportPlaceholder) {
        var defaultValue = obj.getAttribute('placeholder');
        if (!imitateMode) {
            obj.onfocus = function () {
                (obj.value == defaultValue) && (obj.value = '');
                obj.style.color = '';
            }
            obj.onblur = function () {
                if (obj.value == defaultValue) {
                    obj.style.color = '';
                } else if (obj.value == '') {
                    obj.value = defaultValue;
                    obj.style.color = '#ACA899';
                }
            }
            obj.onblur();
        } else {
            var placeHolderCont = document.createTextNode(defaultValue);
            var oWrapper = document.createElement('span');
            oWrapper.style.cssText = 'position:absolute; color:#ACA899; display:inline-block; overflow:hidden;';
            oWrapper.className = 'wrap-placeholder';
            oWrapper.style.fontFamily = getStyle(obj, 'fontFamily');
            oWrapper.style.fontSize = getStyle(obj, 'fontSize');
            oWrapper.style.marginLeft = parseInt(getStyle(obj, 'marginLeft')) ? parseInt(getStyle(obj, 'marginLeft')) + 3 + 'px' : 3 + 'px';
            oWrapper.style.marginTop = parseInt(getStyle(obj, 'marginTop')) ? getStyle(obj, 'marginTop'): 1 + 'px';
            oWrapper.style.paddingLeft = getStyle(obj, 'paddingLeft');
            oWrapper.style.width = obj.offsetWidth - parseInt(getStyle(obj, 'marginLeft')) + 'px';
            oWrapper.style.height = obj.offsetHeight + 'px';
            oWrapper.style.lineHeight = obj.nodeName.toLowerCase()=='textarea'? '':obj.offsetHeight + 'px';
            oWrapper.appendChild(placeHolderCont);
            obj.parentNode.insertBefore(oWrapper, obj);
            oWrapper.onclick = function () {
                obj.focus();
            }
            //绑定input或onpropertychange事件
            if (typeof(obj.oninput)=='object') {
                obj.addEventListener("input", changeHandler, false);
            } else {
                obj.onpropertychange = changeHandler;
            }
            function changeHandler() {
                oWrapper.style.display = obj.value != '' ? 'none' : 'inline-block';
            }
            /**
             * @name getStyle
             * @class 获取样式
             * @param {Object} obj 要获取样式的对象
             * @param {String} styleName 要获取的样式名
             */
            function getStyle(obj, styleName) {
                var oStyle = null;
                if (obj.currentStyle)
                    oStyle = obj.currentStyle[styleName];
                else if (window.getComputedStyle)
                    oStyle = window.getComputedStyle(obj, null)[styleName];
                return oStyle;
            }
        }
    }
}
xue.placeHolder = xue.placeholder;


jQuery.cookie = function(name, value, options) {  
    if (typeof value != 'undefined') { // name and value given, set cookie  
        options = options || {};  
        if (value === null) {  
            value = '';  
            options.expires = -1;  
        }  
        var expires = '';  
        if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {  
            var date;  
            if (typeof options.expires == 'number') {  
                date = new Date();  
                date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));  
            } else {  
                date = options.expires;  
            }  
            expires = '; expires=' + date.toUTCString();  
        }  
        var path = options.path ? '; path=' + (options.path) : '';  
        var domain = options.domain ? '; domain=' + (options.domain) : '';  
        var secure = options.secure ? '; secure' : '';  
        document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');  
    } else {  
        var cookieValue = null;  
        if (document.cookie && document.cookie != '') {  
            var cookies = document.cookie.split(';');  
            for (var i = 0; i < cookies.length; i++) {  
                var cookie = jQuery.trim(cookies[i]);  
                if (cookie.substring(0, name.length + 1) == (name + '=')) {  
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));  
                    break;  
                }  
            }  
        }  
        return cookieValue;  
    }  
}; 
/* ========================== UI 组件 =========================== */

var ui = ui || {};


ui.tabs = ui.tabs || function(id, fn){ 
	if(id === undefined){
		return ui.tabs;
	}
	
	ui.tabs.id = id || 'ui_tabs'; 
	ui.tabs.handle = jQuery('#' + ui.tabs.id);

	if(ui.tabs.handle.length == 0){
		return ui.tabs;
	}
	ui.tabs.handle.off('click', 'li');
	ui.tabs.handle.on('click', 'li', function(){
		jQuery(this).addClass('current').siblings('.current').removeClass('current');
		if(typeof fn === 'function'){
			return fn(this);
		}else{
			return false;
		}
	});

	return ui.tabs; 
};

xue.extend('tabs', ui.tabs);

/* ========================== module =========================== */



/**
 * 准备增加几个别名：
 *
 * x / X : 基础类
 * e / E : 事件类（event）
 * s / S : 
 * u / U : UI组件
 * r / R : 
 * m / M : 方法 / 模块
 */



/* ========== 压缩后的模块 ============= */
// 弹窗 
ui.dialog=ui.dialog||function(a){var b={};if(a&&"object"==typeof a&&void 0===a.length)return jQuery.extend(b,ui.dialog._default,a),ui.dialog._init(b),ui.dialog;if(a&&"string"==typeof a){var c="xuebox_"+a,d=ui.dialog.queue[c];return d&&(ui.dialog.id=c,ui.dialog.box=d.DOM_BOX),ui.dialog}return jQuery.extend(b,ui.dialog._default),ui.dialog._init(b),ui.dialog},function(){var a=ui.dialog;a.id="xuebox",a.tpl={wrap:'<div id="$id$" class="dialog">$dialog_box$ $dialog_close$ $dialog_arrow$</div>',close:'<a href="javascript:void(0);" class="dialog_close">\u5173\u95ed</a>',arrow:'<div class="dialog_arrow arrow_$arrow_type$"></div>',button:'<button type="button" data-type="$btn_type$" id="$id$_btn_$btn_id$" class="btn $btn_cls$ $btn_type$" href="javascript:void(0);">$btn_text$</button>',box:'<table class="dialog_box">\n	<thead><tr class="t"><td class="tl"></td><td class="tc"></td><td class="tr"></td></tr></thead>\n	<tbody class="dialog_head $is_title$">\n		<tr class="ct">\n			<td class="cl"></td>\n			<td class="dialog_handle">\n				<p class="dialog_title" id="$id$_title">$title$</p>\n			</td>\n			<td class="cr"></td>\n		</tr>\n	</tbody>\n	<tbody class="dialog_body">\n		<tr class="cc">\n			<td class="cl"></td>\n			<td id="$id$_content" class="dialog_content_wrap"><div class="dialog_content">$content$</div></td>\n			<td class="cr"></td>\n		</tr>\n	</tbody>\n	<tbody class="dialog_foot $is_buttons$">\n		<tr class="cb">\n			<td class="cl"></td>\n			<td class="dialog_buttons" id="$id$_buttons">$buttons$</td>\n			<td class="cr"></td>\n		</tr>\n	</tbody>\n	<tfoot><tr class="b"><td class="bl"></td><td class="bc"></td><td class="br"></td></tr></tfoot>\n</table>\n',mask:'<div class="dialog_mask"></div>'},a._default={content:'<div class="aui_loading"><span>loading..</span></div>',title:"\u6d88\u606f",handle:null,button:null,ok:null,no:null,submit:null,cancel:null,init:null,close:null,okVal:"\u786e\u5b9a",cancelVal:"\u53d6\u6d88",width:"auto",height:"auto",minWidth:96,minHeight:32,padding:"20px 25px",skin:"",icon:null,time:null,esc:!0,focus:!0,show:!0,follow:null,lock:!1,background:"#000",opacity:.7,duration:300,fixed:!1,left:null,top:null,zIndex:1e3,resize:!0,drag:!0,border:!0,cls:""},a.queue={},a._init=function(b){this.id=b.id?"xuebox_"+b.id:"xuebox",this.queue[this.id]=b;var c=this.tpl.wrap;c=c.replace("$id$",this.id),c=c.replace("$dialog_close$",this._getClose()),c=c.replace("$dialog_box$",this._getDOM()),c=c.replace(/\$dialog_arrow\$/,this._getArrow()),jQuery("#xuebox_"+b.id).length>0&&jQuery("#xuebox_"+b.id).remove(),jQuery(c).css("top",Number(-2000)).appendTo("body"),this.box=jQuery("#"+this.id);var d={DOM_BOX:this.box,DOM_CLOSE:this.box.find(".dialog_close"),DOM_CANCEL:this.box.find(".btn_cancel"),DOM_OK:this.box.find(".btn_ok"),DOM_BUTTONS:this.box.find(".dialog_buttons .btn"),DOM_TITLE:this.box.find(".dialog_title"),DOM_CONTENT:this.box.find(".dialog_content_wrap")};this._setOption("DOM_BOX",d.DOM_BOX),this._setOption("DOM_CLOSE",d.DOM_CLOSE),this._setOption("DOM_CANCEL",d.DOM_CANCEL),this._setOption("DOM_OK",d.DOM_OK),this._setOption("DOM_CONTENT",d.DOM_CONTENT),this._setOption("DOM_TITLE",d.DOM_TITLE),this._setOption("DOM_BUTTONS",d.DOM_BUTTONS),this._setOption(d);var e=this;if(this._addClick(d.DOM_CLOSE,b.close),this._addClick(d.DOM_CANCEL,b.no||b.cancel),this._addClick(d.DOM_OK,b.ok||b.submit),b.button&&b.button.length>0&&jQuery.each(b.button,function(a,b){var c=jQuery("#"+e.id+"_btn_"+b.id);e._addClick(c,b.fn)}),d.DOM_BOX.off("mousedown").on("mousedown",function(){e.id=jQuery(this).attr("id"),e.box=jQuery(this)}),this.resize(),b.lock){var f=b.lockbg?!0:!1;this.lock(f)}b.border?d.DOM_BOX.removeClass("dialog_noborder"):d.DOM_BOX.addClass("dialog_noborder"),d.DOM_BOX.find(".dialog_head:hidden").length>0?d.DOM_CONTENT.addClass("dialog_radius_top"):d.DOM_CONTENT.removeClass("dialog_radius_top"),d.DOM_BOX.find(".dialog_foot:hidden").length>0?d.DOM_CONTENT.addClass("dialog_radius_bottom"):d.DOM_CONTENT.removeClass("dialog_radius_bottom"),b.cls&&d.DOM_BOX.addClass(b.cls),b.time&&this.timeout(b.time,d.DOM_BOX),b.follow&&this.follow(b.follow),this.arrow(b.handle),xue.isIE6?(d.DOM_BOX.addClass("dialog_noshadow"),jQuery("body").find("select").length>0&&a.iframe()):d.DOM_BOX.removeClass("dialog_noshadow")},a.iframe=function(){var b=this.queue[this.id];if(b){var c=jQuery("body").width(),d=jQuery("body").height(),e='<iframe id="dialog_iframe" style="position:fixed;width:100%;height:100%;top:0;left:0;_position:absolute;_width:'+c+";_height:"+d+';_filter:alpha(opacity=0);opacity=0;border-style:none;z-index:998;"></iframe>';jQuery("body").append(e)}},a._getClose=function(){var a=this.queue[this.id];if(a){var b=a.close?this.tpl.close:"";return b}},a._getArrow=function(){var b=this.queue[this.id];if(b){var c=b.arrow;if(c){var d=a.tpl.arrow;return c=c?c===!0?"bc":c:"bc",d=d.replace("$arrow_type$",c)}return""}},a._getButton=function(){var b=this.queue[this.id];if(b){var c=b.button,d=this.tpl.button,e="",f={id:/\$id\$/g,btn:/\$btn_id\$/,type:/\$btn_type\$/g,cls:/\$btn_cls\$/,text:/\$btn_text\$/};if(c&&"object"==typeof c&&c.length>0&&jQuery.each(c,function(b,c){var g=d;g=g.replace(f.id,a.id),g=g.replace(f.btn,c.id),g=g.replace(f.type,"btn_"+c.tp),g=g.replace(f.cls,c.cls),g=g.replace(f.text,c.text),e+=g}),b.submit||b.ok){var g=d;g=g.replace(f.type,"btn_ok"),g=g.replace(f.id,a.id),g=g.replace(f.btn,"ok"),g=g.replace(f.cls,"btn_red"),g=g.replace(f.text,b.submitVal||b.okVal),e+=g}if(b.cancel||b.no){var h=d;h=h.replace(f.type,"btn_cancel"),h=h.replace(f.id,a.id),h=h.replace(f.btn,"cancel"),h=h.replace(f.cls,"btn_gray"),h=h.replace(f.text,b.cancelVal||b.noVal),e+=h}return e}},a._getDOM=function(){var a=this.queue[this.id];if(a){var b=this.tpl.box,c=this.id||xue.getTime();b=b.replace(/\$id\$/g,c),a.title?(b=b.replace(/\$is_title\$/,""),b=b.replace(/\$title\$/,a.title)):(b=b.replace(/\$is_title\$/,"hidden"),b=b.replace(/\$title\$/,this._default.title));var d=this._getButton(),e=d?"":"hidden";return b=b.replace("$buttons$",d),b=b.replace("$is_buttons$",e),b=b.replace("$content$",a.content)}},a._setOption=function(b,c,d){var e=d||a.id,f=a.queue[e];return f[b]=c,a.queue},a._addClick=function(b,c){var d=jQuery(b).parents(".dialog"),e=d.length>0?d.attr("di"):this.id,f=c&&"function"==typeof c?c:function(){a.close()},g=this;jQuery(b).off("click").on("click",function(){g.box=jQuery(this).parents(".dialog"),g.id=g.box.attr("id"),f(this,e)})},a._size={wins:function(){var a=jQuery(window),b={w:a.width(),h:a.height(),s:a.scrollTop()};return b.c=b.w/2,b.m=b.s+b.h/2,b},box:function(){var b=a.queue[a.id];if(!b)return a;var c=b.DOM_BOX,d={w:c.outerWidth(!0),h:c.outerHeight(!0)};return d},handle:function(){var b=a.queue[a.id];if(!b)return a;var c=jQuery(b.handle);if(0==c.length)return a;var d={w:c.width(),h:c.height(),l:c.offset().left,t:c.offset().top};return d.c=d.l+d.w/2,d}},a.close=function(){var b=this.queue[this.id];if(b){this.box.remove(),xue.isIE6&&jQuery("#dialog_iframe").remove(),delete this.queue[this.id];var c=!1;jQuery.each(this.queue,function(){this.lock&&(c=!0)}),c||this.unlock()}},a.position=function(a,b){var c=[];if(a&&"number"==typeof a||b&&"number"==typeof b){var d=this.queue[this.id];if(!d)return;d.left=a||d.left,d.top=b||d.top,c.push(d)}else{var d=this.queue[this.id];c.push(d)}return jQuery.each(c,function(){var c=this,d=c.DOM_BOX,e={left:a||c.left||jQuery(window).width()/2-d.width()/2,top:b||c.top||jQuery(window).height()/2-d.height()/2};d.css({left:e.left,top:e.top})}),this},a.resize=function(a,b){var c=this.queue[this.id];if(c){if((a||c.width)&&(b||c.height)){var d=c.DOM_BOX,e=d.find(".dialog_content");e.css({width:a||c.width,height:b||c.height}),this.position()}return this}},a.zIndex=function(){},a.focus=function(){},a.getContent=function(a){var b=this.queue[this.id];if(b){var c=b.DOM_CONTENT.find(".dialog_content"),d="";return d="html"===a?c.html():"text"===a?c.text():c}},a.lock=function(a){var b=jQuery("body").find(".dialog_mask");b.length>0?b.show():jQuery("body").append(this.tpl.mask);var c=jQuery(".dialog_mask");if(a?c.addClass("mask_bg"):jQuery(".dialog_mask").removeClass("mask_bg"),xue.isIE6){var d=Math.max(jQuery("body").outerHeight(),jQuery(window).outerHeight());c.height(d)}c.height()<jQuery(window).height()&&c.height(jQuery(window).height())},a.unlock=function(){jQuery(".dialog_mask").remove()},a.content=function(a){var b=this.queue[this.id];if(!b)return this;var c=b.DOM_BOX.find(".dialog_content");return c.html(a),this.resize(),this},a.title=function(a){var b=this.queue[this.id];if(!b)return this;var c=b.DOM_BOX.find(".dialog_title");return c.html(a),this},a.timeout=function(a,b){var c=a||2e3,d=this,e=this.queue[this.id];if(!e)return this;var f=b||e.DOM_BOX;setTimeout(function(){f.fadeOut(100,function(){d.close()})},c)},a.getSize=function(){var a=this.queue[this.id];if(!a)return this;var b=a.DOM_BOX,c=b.outerWidth(),d=b.outerHeight();return{width:c,height:d}},a._getHandleSize=function(a){var b=jQuery(a);if(0===b.length)return!1;var c=b.offset(),d={height:b.outerHeight(!0),width:b.outerWidth(!0),left:c.left,top:c.top};return d},a.follow=function(b){var c=jQuery(b);if(0===c.length)return this;var d=this.queue[this.id];if(!d)return this;var e=d.DOM_BOX;e.hasClass("dialog_follow")&&e.addClass("dialog_follow");var f=this._getHandleSize(c),g={width:e.outerWidth(!0),height:e.outerHeight(!0)};return a.position(f.left-g.width/2+f.width/2,f.top-g.height/2-f.height-11),this},a.arrow=function(a){var b=jQuery(a);if(0!=b.length){var c=this.queue[this.id];if(!c)return this;var d=c.DOM_BOX,e=this._size.wins(),f=this._size.handle(),g=this._size.box(),h=f.c<e.c?"l":"r",i=f.t-g.h<e.s?"t":"b",j=i+h,k=d.find(".dialog_arrow");k.removeClass().addClass("dialog_arrow").addClass("arrow_"+j);var l=Math.floor("l"==h?.2*g.w:.8*g.w);k.css({"background-position":l+"px 0"})}}}(),xue.extend("dialog",ui.dialog),xue.alert=function(a,b){if(a&&""!==a){var d=b||!0,e=xue.dialog;return e({id:"alert",cls:"dialog_alert",title:!1,lock:!0,close:!1,content:a,time:3e3,cancel:function(){"function"==typeof d&&d(),xue.dialog("alert").close()},cancelVal:"\u786e\u5b9a",submit:!1})}},xue.confirm=function(a,b,c){if(a&&""!==a){var d=b||!0,e=c||!0,f=xue.dialog;return f({id:"confirm",cls:"dialog_confirm",title:!1,lock:!0,content:a,submit:function(){"function"==typeof d&&d(),xue.dialog("confirm").close()},cancel:function(){"function"==typeof e&&e(),xue.dialog("confirm").close()}})}},xue.poptips=function(a,b,c){if(a&&""!==a){var d=c?"number"==typeof c?c:1e3:null,e={id:"poptips",cls:"dialog_poptips",title:!1,submit:!1,cancel:!1,lock:!1,close:!1,follow:b||null,arrow:!0,content:'<div class="dialog_success"><em class="dialog_icon"></em>'+a+"</div>",time:d},f=xue.dialog;f(e);var g=jQuery(".dialog_poptips");g.find(".dialog_arrow").width(g.width())}},xue.win=xue.dialog,function(){var a=xue.win,b={id:"win",lock:!0,close:!0,title:"\u6807\u9898",content:"<div></div>",submit:!0,cancel:!0};jQuery.each(b,function(b,c){a._default[b]=c})}();


// 分页
ui.pages=ui.pages||function(a){return ui.pages.id=a||"ui_pages",ui.pages},function(){var a=ui.pages;a.queue={};var b={id:"ui_pages",handle:"#ui_pages",size:5,bitwise:2,current:1,pages:20,pageCount:20,pageNum:20,prevText:"\u4e0a\u4e00\u9875",nextText:"\u4e0b\u4e00\u9875",prev:".pages_prev:not(.disable)",next:".pages_next:not(.disable)",item:".pages_item",html:"",fn:{},firstText:null,lastText:null,isMore:!0,callback:!1},c={wrap:'<ol class="ui_pages"></ol>',page:'<li class="pages_item" data-page="$pageData$"><a href="javascript:void(0);">$pageText$</a></li>',more:'<li class="pages_more"><span>...</span></li>',current:'<li class="pages_current"><span>$pageText$</span></li>',prev:'<li class="pages_prev $disabled$"><a href="javascript:void(0);" class="btn btn_gray $disable$">'+b.prevText+"</a></li>",next:'<li class="pages_next $disabled$"><a href="javascript:void(0);" class="btn btn_gray $disable$">'+b.nextText+"</a></li>"};a.config=function(c){this.id=void 0===this.id?b.id:this.id,c.id=c.id||this.id,c.handle=c.handle||jQuery("#"+c.id);var d={opt:{}};"object"==typeof c&&void 0===c.length?jQuery.extend(d,b,c):jQuery.extend(d,b),d.bitwise=d.size>>1,d.pageCount=Math.ceil(Number(d.pages)/Number(d.pageNum)),this.queue[this.id]=d;var e=void 0;return(d.pageClick||d.prevClick||d.nextClick)&&(e={}),"function"==typeof d.pageClick&&(d.fn.pageClick=d.pageClick),"function"==typeof d.prevClick&&(d.fn.prevClick=d.prevClick),"function"==typeof d.nextClick&&(d.fn.nextClick=d.nextClick),this.fn(this.id,d.fn),d.current>0&&d.pageCount>0&&a(this.id).go(d.current),c=d=e=this.id=void 0,this},a.createItem=function(a,b,d){var d="current"===d?"current":"page",b=b||a,e=c[d].replace("$pageText$",b);return e=e.replace("$pageData$",a)},a.createBtn=function(a,b){var d="prev"===a?"prev":"next",e=b?"btn_disable":"",f=b?"disable":"",g=c[d].replace(/\$disable\$/g,e);return g=g.replace(/\$disabled\$/g,f)},a.createMore=function(){var a=this.queue[this.id],b=a.isMore?c.more:"";return b},a.createPages=function(a,b){var c=this.queue[this.id],b=b||c.pageCount;c.pageCount=b>0?b:1;var a=a||c.current;if(c.current=a>0?a>b?b:a:1,1===b)return" ";var d,e,f,g,h,i,k,l,m;if(h=this.createBtn("prev",1===a?!0:!1),i=this.createBtn("next",a===b?!0:!1),d=Number(a-c.bitwise),d=1>d?1:d,g=Number(a+c.bitwise),g=g>b?b:g,e=this.createMore(),k=g<=c.size?"":this.createItem(1,c.firstText),l=d>b-c.size?"":this.createItem(b,c.lastText),10>=b){m=h;for(var n=1;b>=n;n++){var o=n===a?"current":!1;m+=this.createItem(n,n,o)}return m+=i}g<=c.size&&(d=1,g=c.size),d>b-c.size&&(d=b-c.size+1,g=b),f="";for(var n=d;g>=n;n++){var o=n===a?"current":!1;f+=this.createItem(n,n,o)}return m=h+k,m+=g<=c.size+1?"":e,m+=f,m+=d>=b-c.size?"":e,m+=l+i},a.append=function(a){var b=this.queue[this.id],a=a||b.html;jQuery(b.handle).html(a)},a.getPagesHTML=function(){var a=this.queue[this.id],b=this.createPages(a.current,a.pageCount),d=jQuery(c.wrap),e=d.html(b);return a.html=e,e},a.go=function(a,c){this.id=this.id||b.id;var d=this.queue[this.id];d.current=a>0?a:d.current,d.pageCount=c||d.pageCount;var e=this.getPagesHTML();return this.append(e),jQuery("html,body").animate({scrollTop:0},"fast"),this},a.fn=function(b){var d=this.queue[b];jQuery(window).scrollTop(0);var e=function(c){a(b).go(c,d.pageCount)},f=function(a,b){var b=b||"page";return d.callback?d.callback(a,d.pageCount):d.fn[b+"Click"]?d.fn[b+"Click"](a,d.pageCount):"default"},g=1,h=!1,i=1;d.handle.off("click",d.item),d.handle.on("click",d.item,function(){return g=jQuery(this).data("page"),h=f(g,"page"),void 0!==h?e(g):void 0}),d.handle.off("click",d.prev),d.handle.on("click",d.prev,function(){var a=jQuery(this);return a.find(".btn_disable").length>0?!1:(i=d.current,i--,g=i>0?i:0,h=f(g,"prev"),void 0!==h?e(g):void 0)}),d.handle.off("click",d.next),d.handle.on("click",d.next,function(){var a=jQuery(this);return a.find(".btn_disable").length>0?!1:(i=d.current,i++,g=i>d.pageCount?d.pageCount:i,h=f(g,"next"),void 0!==h?e(g):void 0)})},a.click=function(b){var c=this.queue[this.id];if("function"==typeof b){var d=a(this.id).getPagesHTML();return b(c.current,d)}}}(),xue.pages=ui.pages;



/**
 * @name ui.message.js
 * @description 信息
 * 
 * @module 
 * @submodule 
 * @main 
 * @class 
 * @constructor 
 * @static 
 */

xue.message = xue.message || {};

(function(){
    var m = xue.message;

    /**
     * 激活当前类别的信息
     * @param  {[type]} type [description]
     * @return {[type]}      [description]
     */
    m.setCurrent = function( type ){
        var tp = type || 1;
        
        var box = jQuery('#nav_tab'), list= box.find('li');
        var act = box.find('li[data-type="' + tp + '"]');
        if(act.length == 0){ return false; }

        // 让对应类别进行一次模拟点击
        act.click();

    };

    /**
     * 清除新消息提示
     * @param  {[type]} type [description]
     * @return {[type]}      [description]
     */
    m.clearNewTips = function( type ){
        var tp = type || 1;
        var top = jQuery('#headerNew .ui_topbar_pop .msg_tips li[data-type=' + tp + ']'), 
            pop = jQuery('#headerNew .layer_news_tips .msg_tips li[data-type=' + tp + ']'), 
            nav = jQuery('#nav_tab li[data-type="' + tp + '"]');
        // 清除顶部下拉列表里面的数字
        if(top.length > 0){
            top.find('a strong').remove();
        }
        // 清除顶部悬浮新消息里面的内容
        if(pop.length > 0){
            var wrap = pop.parents('.layer_news_tips');
            pop.remove();
            if(wrap.find('li').length == 0){
                wrap.remove();
            }
        }
        // 清除我的通知页面里 通知类别上的小红点
        if(nav.length > 0){
            nav.find('em.icon_new').remove();
        }

        // 当全部新消息为空的时候，清除新消息的小圆点；
        var top_new_icon = jQuery('em.icon_messages').parent().find('em.icon_new'),
            top_new = jQuery('.ui_topbar_pop strong');

        if(top_new.length == 0){
            top_new_icon.remove();
            jQuery('#headerNew .loginbar .tips').children('p').find('em.icon_new').remove();
        }
    };

})();



// 输入框焦点提示效果：by bluebird
jQuery.focusblur = function(focusid){
	var focusblurid = jQuery(focusid);
	var defval = focusblurid.data('place');
    focusblurid.focus(function(){
		var thisval = xue.isIE ? jQuery(this).val() : jQuery(this).prop('placeholder');
		if(thisval==defval){
			if(xue.isIE){
				jQuery(this).val('');
			}else{
		   		jQuery(this).prop('placeholder','');
			}
	 	}
	}); 
	
    focusblurid.blur(function(){
		var thisval = xue.isIE ? jQuery(this).val() : jQuery(this).prop('placeholder');
		if(thisval==''){
			if(xue.isIE){
				if(!jQuery(this).is(':password')){
					jQuery(this).val(defval);
				}
			}else{
            	jQuery(this).prop('placeholder', defval);
			}
        }
    }); 
};

//倒计时
xue.countdown = null;
xue.updateEndTime = function(box){
	var box = jQuery(box);
	if(box.length == 0){
		return false;
	}
         var date = new Date();
         var time = date.getTime();  //当前时间距1970年1月1日之间的毫秒数
      	box.each(function(i){
           var endDate =this.getAttribute("endTime"); //结束时间字符串
           //转换为时间日期类型
           var endDate1 = eval('new Date(' + endDate.replace(/\d+(?=-[^-]+$)/, function (a) { return parseInt(a, 10) - 1; }).match(/\d+/g) + ')');
           var endTime = endDate1.getTime(); //结束时间毫秒数
           var lag = (endTime - time) / 1000; //当前时间和结束时间之间的秒数
           var nMS=2000000000*1000 - date.getTime();
            if(lag > 0){
             var nMS=Math.floor(nMS/100) % 10;
             var second = Math.floor(lag % 60);    
             var minite = Math.floor((lag / 60) % 60);
             var hour = Math.floor((lag / 3600) % 24 );
             // xue.log(hour % 24);
             var day = Math.floor((lag / 3600) / 24);
             jQuery(this).html(day+"天 " + hour+"时" + minite+"分" +second+"."+nMS+"秒");
            }else
             jQuery(this).html("优惠已经结束啦！");
            });

        xue.countdown = setTimeout(function(){
        	xue.updateEndTime(box);
        },100);
}
xue.clearEndTime = function(){
	clearTimeout(xue.countdown);
};

/* ========== 全局事件 ============= */
jQuery(window).resize(function(){
	if(jQuery('.dialog').length > 0){
		xue.win.position();
	}
});


jQuery(function(){

    if(xue.isFirefox){
        // 火狐下禁止缓存表单
        jQuery('input').prop('autocomplete', 'off');
    }

	//头部选课程
	var topselect_course = false, topselect_interval = null, 
		topselect_i = 0, topselect_message = 0, topselect_setting = 0
		topselect = {
			0:0,
			1:0,
			2:0
		};
    jQuery('#headerNew .navs li.course').on('mouseenter', function(a){
        var that = jQuery(this);
		topselect_interval = setInterval(function(){
			topselect_i++;
			if(topselect_i > 3){
	        	that.addClass('course_select');
			}
		}, 100);

		that.on('mouseleave', function(event){
    		that.removeClass('course_select');
    		clearInterval(topselect_interval);
    		topselect_i = 0;
        });
        that.find('.layer_head_menu').on('mouseenter', function(){
        	clearInterval(topselect_interval);
    		topselect_i = 0;
        });
    });
    // 头部右侧点击下拉

    jQuery('#headerNew .loginbar > li').on('mouseenter', function(ee){
    	var that = jQuery(this);
    	if(that.hasClass('shopcart')){ return false; }

    	var newMessage = jQuery('.layer_news_tips'),
    		index = jQuery(this).index();
    	topselect_interval = setInterval(function(){
    		topselect_message++;
			if(topselect_message > 3){
	        	that.addClass('current');
	        	// newMessage.hide();
			}
    	}, 100);

    	that.off('mouseleave').on('mouseleave', function(event){
    		that.removeClass('current');
    		// newMessage.show();
    		clearInterval(topselect_interval);
    		topselect_message = 0;
        });
    
    });

    // 头部新消息浮层的关闭事件
    // jQuery('#headerNew').off('click', '.layer_news_tips .close').on('click', '.layer_news_tips .close', function(){
    jQuery('#headerNew .layer_news_tips .close').on('click', function(){
        var box = jQuery(this).parents('.layer_news_tips');
        box.remove();
    });

    // 头部信息点击事件
    // jQuery('#headerNew').off('click', '.msg_tips a').on('click', '.msg_tips a', function(){
    jQuery('#headerNew .msg_tips a').on('click', function(){
        var that = this, a = jQuery(this).attr('href').split('#_'), loc = window.location;
        var link = { url : a[0], tp  : a[1] };
        var href = { url : loc.pathname, tp  : loc.href.split('#_')[1] };
        // 如果不是消息页面，直接跳转
        if(link.url !== href.url){ return true; }

        // 如果时信息页面则执行
        xue.use('message', function(){
            xue.message.setCurrent(link.tp);
        });
    });
	
    jQuery('input[placeholder]').each(function(){
		var tips = jQuery(this).prop('placeholder');
		jQuery(this).data('place', tips);
		if(xue.isIE){
			if(jQuery(this).val() == '' && !jQuery(this).is(':password')){
				jQuery(this).val(tips);
			}
		}
		jQuery.focusblur(this);
	});

    // 选课下拉效果
    jQuery('.GradeMenu').hover(function() {
   		jQuery(this).addClass('hover');//添加hover,显示
   	}, function() {
   		jQuery(this).removeClass('hover');//删除hover,隐藏
   	});
});


/* ========================== IE6兼容 =========================== */
// IE6下的内容
if(xue.isIE6){

	// png去背景
	var DD_belatedPNG={ns:"DD_belatedPNG",imgSize:{},delay:10,nodesFixed:0,createVmlNameSpace:function(){if(document.namespaces&&!document.namespaces[this.ns]){document.namespaces.add(this.ns,"urn:schemas-microsoft-com:vml")}},createVmlStyleSheet:function(){var b,a;b=document.createElement("style");b.setAttribute("media","screen");document.documentElement.firstChild.insertBefore(b,document.documentElement.firstChild.firstChild);if(b.styleSheet){b=b.styleSheet;b.addRule(this.ns+"\\:*","{behavior:url(#default#VML)}");b.addRule(this.ns+"\\:shape","position:absolute;");b.addRule("img."+this.ns+"_sizeFinder","behavior:none; border:none; position:absolute; z-index:-1; top:-10000px; visibility:hidden;");this.screenStyleSheet=b;a=document.createElement("style");a.setAttribute("media","print");document.documentElement.firstChild.insertBefore(a,document.documentElement.firstChild.firstChild);a=a.styleSheet;a.addRule(this.ns+"\\:*","{display: none !important;}");a.addRule("img."+this.ns+"_sizeFinder","{display: none !important;}")}},readPropertyChange:function(){var b,c,a;b=event.srcElement;if(!b.vmlInitiated){return}if(event.propertyName.search("background")!=-1||event.propertyName.search("border")!=-1){DD_belatedPNG.applyVML(b)}if(event.propertyName=="style.display"){c=(b.currentStyle.display=="none")?"none":"block";for(a in b.vml){if(b.vml.hasOwnProperty(a)){b.vml[a].shape.style.display=c}}}if(event.propertyName.search("filter")!=-1){DD_belatedPNG.vmlOpacity(b)}},vmlOpacity:function(b){if(b.currentStyle.filter.search("lpha")!=-1){var a=b.currentStyle.filter;a=parseInt(a.substring(a.lastIndexOf("=")+1,a.lastIndexOf(")")),10)/100;b.vml.color.shape.style.filter=b.currentStyle.filter;b.vml.image.fill.opacity=a}},handlePseudoHover:function(a){setTimeout(function(){DD_belatedPNG.applyVML(a)},1)},fix:function(a){if(this.screenStyleSheet){var c,b;c=a.split(",");for(b=0;b<c.length;b++){this.screenStyleSheet.addRule(c[b],"behavior:expression(DD_belatedPNG.fixPng(this))")}}},applyVML:function(a){a.runtimeStyle.cssText="";this.vmlFill(a);this.vmlOffsets(a);this.vmlOpacity(a);if(a.isImg){this.copyImageBorders(a)}},attachHandlers:function(i){var d,c,g,e,b,f;d=this;c={resize:"vmlOffsets",move:"vmlOffsets"};if(i.nodeName=="A"){e={mouseleave:"handlePseudoHover",mouseenter:"handlePseudoHover",focus:"handlePseudoHover",blur:"handlePseudoHover"};for(b in e){if(e.hasOwnProperty(b)){c[b]=e[b]}}}for(f in c){if(c.hasOwnProperty(f)){g=function(){d[c[f]](i)};i.attachEvent("on"+f,g)}}i.attachEvent("onpropertychange",this.readPropertyChange)},giveLayout:function(a){a.style.zoom=1;if(a.currentStyle.position=="static"){a.style.position="relative"}},copyImageBorders:function(b){var c,a;c={borderStyle:true,borderWidth:true,borderColor:true};for(a in c){if(c.hasOwnProperty(a)){b.vml.color.shape.style[a]=b.currentStyle[a]}}},vmlFill:function(e){if(!e.currentStyle){return}else{var d,f,g,b,a,c;d=e.currentStyle}for(b in e.vml){if(e.vml.hasOwnProperty(b)){e.vml[b].shape.style.zIndex=d.zIndex}}e.runtimeStyle.backgroundColor="";e.runtimeStyle.backgroundImage="";f=true;if(d.backgroundImage!="none"||e.isImg){if(!e.isImg){e.vmlBg=d.backgroundImage;e.vmlBg=e.vmlBg.substr(5,e.vmlBg.lastIndexOf('")')-5)}else{e.vmlBg=e.src}g=this;if(!g.imgSize[e.vmlBg]){a=document.createElement("img");g.imgSize[e.vmlBg]=a;a.className=g.ns+"_sizeFinder";a.runtimeStyle.cssText="behavior:none; position:absolute; left:-10000px; top:-10000px; border:none; margin:0; padding:0;";c=function(){this.width=this.offsetWidth;this.height=this.offsetHeight;g.vmlOffsets(e)};a.attachEvent("onload",c);a.src=e.vmlBg;a.removeAttribute("width");a.removeAttribute("height");document.body.insertBefore(a,document.body.firstChild)}e.vml.image.fill.src=e.vmlBg;f=false}e.vml.image.fill.on=!f;e.vml.image.fill.color="none";e.vml.color.shape.style.backgroundColor=d.backgroundColor;e.runtimeStyle.backgroundImage="none";e.runtimeStyle.backgroundColor="transparent"},vmlOffsets:function(d){var h,n,a,e,g,m,f,l,j,i,k;h=d.currentStyle;n={W:d.clientWidth+1,H:d.clientHeight+1,w:this.imgSize[d.vmlBg].width,h:this.imgSize[d.vmlBg].height,L:d.offsetLeft,T:d.offsetTop,bLW:d.clientLeft,bTW:d.clientTop};a=(n.L+n.bLW==1)?1:0;e=function(b,p,q,c,s,u){b.coordsize=c+","+s;b.coordorigin=u+","+u;b.path="m0,0l"+c+",0l"+c+","+s+"l0,"+s+" xe";b.style.width=c+"px";b.style.height=s+"px";b.style.left=p+"px";b.style.top=q+"px"};e(d.vml.color.shape,(n.L+(d.isImg?0:n.bLW)),(n.T+(d.isImg?0:n.bTW)),(n.W-1),(n.H-1),0);e(d.vml.image.shape,(n.L+n.bLW),(n.T+n.bTW),(n.W),(n.H),1);g={X:0,Y:0};if(d.isImg){g.X=parseInt(h.paddingLeft,10)+1;g.Y=parseInt(h.paddingTop,10)+1}else{for(j in g){if(g.hasOwnProperty(j)){this.figurePercentage(g,n,j,h["backgroundPosition"+j])}}}d.vml.image.fill.position=(g.X/n.W)+","+(g.Y/n.H);m=h.backgroundRepeat;f={T:1,R:n.W+a,B:n.H,L:1+a};l={X:{b1:"L",b2:"R",d:"W"},Y:{b1:"T",b2:"B",d:"H"}};if(m!="repeat"||d.isImg){i={T:(g.Y),R:(g.X+n.w),B:(g.Y+n.h),L:(g.X)};if(m.search("repeat-")!=-1){k=m.split("repeat-")[1].toUpperCase();i[l[k].b1]=1;i[l[k].b2]=n[l[k].d]}if(i.B>n.H){i.B=n.H}d.vml.image.shape.style.clip="rect("+i.T+"px "+(i.R+a)+"px "+i.B+"px "+(i.L+a)+"px)"}else{d.vml.image.shape.style.clip="rect("+f.T+"px "+f.R+"px "+f.B+"px "+f.L+"px)"}},figurePercentage:function(d,c,f,a){var b,e;e=true;b=(f=="X");switch(a){case"left":case"top":d[f]=0;break;case"center":d[f]=0.5;break;case"right":case"bottom":d[f]=1;break;default:if(a.search("%")!=-1){d[f]=parseInt(a,10)/100}else{e=false}}d[f]=Math.ceil(e?((c[b?"W":"H"]*d[f])-(c[b?"w":"h"]*d[f])):parseInt(a,10));if(d[f]%2===0){d[f]++}return d[f]},fixPng:function(c){c.style.behavior="none";var g,b,f,a,d;if(c.nodeName=="BODY"||c.nodeName=="TD"||c.nodeName=="TR"){return}c.isImg=false;if(c.nodeName=="IMG"){if(c.src.toLowerCase().search(/\.png$/)!=-1){c.isImg=true;c.style.visibility="hidden"}else{return}}else{if(c.currentStyle.backgroundImage.toLowerCase().search(".png")==-1){return}}g=DD_belatedPNG;c.vml={color:{},image:{}};b={shape:{},fill:{}};for(a in c.vml){if(c.vml.hasOwnProperty(a)){for(d in b){if(b.hasOwnProperty(d)){f=g.ns+":"+d;c.vml[a][d]=document.createElement(f)}}c.vml[a].shape.stroked=false;c.vml[a].shape.appendChild(c.vml[a].fill);c.parentNode.insertBefore(c.vml[a].shape,c)}}c.vml.image.shape.fillcolor="none";c.vml.image.fill.type="tile";c.vml.color.fill.on=false;g.attachHandlers(c);g.giveLayout(c);g.giveLayout(c.offsetParent);c.vmlInitiated=true;g.applyVML(c)}};try{document.execCommand("BackgroundImageCache",false,true)}catch(r){}DD_belatedPNG.createVmlNameSpace();DD_belatedPNG.createVmlStyleSheet();

	xue.use('ie6', function(){
		xue.ie6.png();
	});
}

