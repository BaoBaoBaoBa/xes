//返回顶部
//2013-13-07-30

var X, xue;
xue = xue || function(expr, fn) {
    return xue.dom ? xue.dom(expr, fn) : {};
};
xue.feedback = xue.feedback || {};
(function(){
	var f = xue.feedback;
	f.tpl = '<div class="rightResearchLive" id="FeedBack">'
					+'		<ul>'
					+'			<li><a xes_id="side_QQ" id="r_copyright" href="http://bbs.xueersi.com/thread-280270-1-1.html" target="_blank"></a></li>'
					+'			<li id="copy_notice">'
					+'			</li>'
					+'		</ul>'
					+'	</div>';
	f.append = function(){
		if($('#FeedBack').length == 0){
				$('body').append(f.tpl);
		}else{
			$('#FeedBack').show();
		}

		f.listener();
		return this;
	};

	f.listener = function(){
		$('body').on('mouseenter','#r_copyright', function(){
			f.hover(this);
		});
	};
	f.hover = function(d){
		var that = $(d);
		var bbs ='http://bbs.xueersi.com/thread-280270-1-1.html';
		$.ajax({
			url:'http://www.xueersi.com/Index/ajaxGetQqHref/',
			type: 'get',
			dataType: 'jsonp',
			jsonp:'jsonpCallback',
			success : function(result){
				if(result.sign > 0){
					//alert(result.msg.group_name);
					// that.attr('href',result.msg.qqUrl);
					var tpl ='<div style="height:72px;overflow:hidden;">'
								+'<p class="group_name">'+result.msg.group_name +'</p>'
							    +'<p class="group_num copy_notice_num">'+result.msg.group_num +'</p>'
								+'</div>'
							  +'<p style="font-size:12px;color:#999; font-weight:normal;font-family: 宋体;"><span style="color:#cc0000;">提示：</span>复制上面群号，打开QQ，在找群中查找并加入网校官方群</p>';
							  // +'<a class="copy_btn zeroclipboard-is-hover" data-clipboard-text="'+result.msg.group_num +'" href="javascript:void(0);">复制群号</a>';
								$('#copy_notice').html(tpl);
								$('#copy_notice').show();
				}
			}
		})
		that.on('mouseleave', function(e){
			var tar = $(e.relatedTarget);
			that.attr('href', bbs);
			if(tar.attr('id') == 'copy_notice' || $(tar).parents('#copy_notice').length > 0){
				that.addClass('current');
				$('#copy_notice').on('mouseleave', function(){
					var that = $(this);
					setTimeout(function(){
						that.hide();
						$('#r_copyright').removeClass('current');
					}, 5000);	
				});
			}else{
				$('#copy_notice').hide();
				that.removeClass('current');
			}
		});
		// that.on('mouseleave', function(e){
		// 	var tar = e.relatedTarget;
		// 	that.attr('href', bbs);
		// });
	};
})();

$(function(){
	xue.feedback.append();
});