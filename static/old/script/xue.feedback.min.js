//返回顶部
//2013-13-07-30


xue.feedback = xue.feedback || {};

(function(){
	var f = xue.feedback;

	f.tpl = '<div class="rightResearch" id="FeedBack">'
					+'		<ul>'
					+'			<li><a xes_id="side_guide" id="r_guide" href="javascript:void(0)"></a>'
					+'			<div id="school_guide">'
					+'			<a class="studyway" href="javascript:void(0)"></a>'
					+'			<a class="buyclass" href="javascript:void(0)"></a>'
					+'			<a class="listenclass" href="javascript:void(0)"></a>'
					+'			<a class="register" href="javascript:void(0)"></a>'
					+'			</div></li>'
					+'			<li><a xes_id="side_QQ" id="r_copyright" href="http://bbs.xueersi.com/thread-280270-1-1.html" target="_blank"></a></li>'
					+'			<li><a xes_id="side_feedback" id="r_feedBack" target="_blank" href="http://bbs.xueersi.com/thread-362132-1-1.html"></a></li>'
					+'			<li><a id="r_toTop" href="javascript:scroll(0,0);" style="display:none;"></a></li>'
					+'			<li id="copy_notice" style="width:170px;">'
					+'			</li>'
					+'		</ul>'
					+'	</div>';
					
	f._tpl='<div class="rightResearch" id="FeedBack">'
					+'		<ul>'
					+'			<li style="width:67px;height:64px"></li>'
					+'			<li><a xes_id="side_QQ" id="r_copyright" href="http://bbs.xueersi.com/thread-280270-1-1.html" target="_blank"></a></li>'
					+'			<li><a xes_id="side_feedback" id="r_feedBack" target="_blank" href="http://bbs.xueersi.com/thread-362132-1-1.html"></a></li>'
					+'			<li><a id="r_toTop" href="javascript:scroll(0,0);" style="display:none;"></a></li>'
					+'			<li id="copy_notice" style="width:170px;">'
					+'			</li>'
					+'		</ul>'
					+'	</div>';
					
	f.append = function(){
		if(!f.isVisable()||f.isLowResolution()){
			return false;
		}

		if($('#FeedBack').length == 0){
			if(f.isGuideExist()){
				$('body').append(f.tpl);
			}else{
				$('body').append(f._tpl);
			}
			
		}else{
			$('#FeedBack').show();
		}

		f.listener();

		return this;
	};

	f.listener = function(){
		$('#r_copyright').on('mouseenter', function(){
			f.hover(this);
		});
		$(window).scroll(function(){
			f.gotop();
		});	
	};

	f.gotop = function(){
		var _scrollTop = $(window).scrollTop();
		if(_scrollTop > $(window).height()){
			$('#r_toTop').show();	
		}else{
			$('#r_toTop').hide();
		}
	};

	f.hover = function(d){
		var that = $(d);
		$.ajax('/index/ajaxGetQqGroupInfo', {
			type: 'post',
			dataType: 'json',
			success : function(v){
				if(v.sign > 0){
					var tpl ='<div style="height:72px;overflow:hidden;">'
						        +'<p class="group_name">'+ v.msg.group_name + '</p>'
								+'<p class="group_num copy_notice_num">'+ v.msg.group_num +'</p>'
							+'</div>'
							+'<p style="font-size:12px;color:#999; font-weight:normal;font-family: 宋体;"><span style="color:#cc0000;">提示：</span>复制上面群号，打开QQ，在找群中查找并加入网校官方群</p>';
							// +'<p class="group_verify">验证信息“'+ v.msg.verify_content + '”</p>';
							// if(v.msg.join_group_script){
							// 	tpl += '<p class="group_join">'+ v.msg.join_group_script + '<a class="qqgroup_info" target="_blank" href="http://www.xueersi.com/Article/detail/1543"><img src="http://img04.xesimg.com/qq_group_qa.jpg"/></a></p>';
							// }
					$('#copy_notice').html(tpl);
					$('#copy_notice').show();
				}
			}
		})
		that.on('mouseleave', function(e){
			var tar = $(e.relatedTarget);
			if(tar.attr('id') == 'copy_notice' || $(tar).parents('#copy_notice').length > 0){
				that.addClass('current');
				$('#copy_notice').on('mouseleave', function(){
					var that = $(this);
					setTimeout(function(){
						that.hide();
						$('#r_copyright').removeClass('current');
					}, 5000);
				});
			}else{
				$('#copy_notice').hide();
				that.removeClass('current');
			}
		});
	};

	f.isVisable = function(){
		var url = window.location.href;
		if(url.indexOf('shoppingCart') < 0 && url.indexOf('MyCourses') < 0 ){
			return true;
		}else{
			return false;
		};
	};
	f.isLowResolution=function(){
		var h = window.screen.height,
    		w = window.screen.width;
    	return w <= 1024 ? true : false;
	};
	f.isGuideExist=function(){
		var url=window.location.href;
			url=url.toLowerCase();
			//console.log(url);
		var flag=false,
			indexUrl='http://www.xueersi.com/',
			urlArr=['/opencourse','/teacher','/glory','/xiao','/chu','/gao'];
			if(url==indexUrl){
				flag=true;
				return flag;
			}else{
				var i=0,
					len=urlArr.length;
				for(i;i<len;i++){
					if(url.indexOf(urlArr[i])>=0){
						flag=true;
					    break;
					}
				}
				return flag;
			}
	}

})();

function rightGuide(){
		var r_guide=$('#r_guide');
		var school_guide=$('#school_guide');
		var box_a=$('#school_guide a');
		var add1='http://www.xueersi.com/video/getPublicVideo/183640/',   //如何学习
			add2='http://www.xueersi.com/video/getPublicVideo/183639/',   //课程购买
			add3='http://www.xueersi.com/video/getPublicVideo/183638/',   //课程试听
			add4='http://www.xueersi.com/video/getPublicVideo/183637/',   //用户注册
			add='http://www.xueersi.com/flash/xueersiPlayer.swf?1408333097';
		var timer=null;
		r_guide.parent().on('mouseenter',function(){
			r_guide.css('background','url("http://img04.xesimg.com/school_guide.gif") -273px 0px no-repeat');
			timer=setTimeout(function(){
				school_guide.fadeIn(400);
			},500)
			
		});
		r_guide.parent().on('mouseleave',function(){
			clearTimeout(timer);
			school_guide.fadeOut(400);
			r_guide.css('background','url("http://img04.xesimg.com/school_guide.gif") -273px -82px no-repeat');
			
			
			
		})

	//$('#school_guide').stop().animate({'right':right});
		box_a.on('mouseenter',function(){
			var that=$(this);
			var classname=that.attr('class');
			that.removeClass(classname);
			classname=classname+'2';
			that.addClass(classname);
		});
		box_a.on('mouseleave',function(){
			var that=$(this);
			var classname=that.attr('class');
			that.removeClass(classname);
			classname=classname.replace(/2/,'');
			that.addClass(classname);
		});

		box_a.on('click',function(){
			var _class=$(this).attr('class');
			if(_class.indexOf('studyway')>=0){
				videoPlay(add1,add,'如何学习');
				return
			}
			if(_class.indexOf('buyclass')>=0){
				videoPlay(add2,add,'课程购买');
				return
			}
			if(_class.indexOf('listenclass')>=0){
				videoPlay(add3,add,'课程试听');
				return
			}
			if(_class.indexOf('register')>=0){
				videoPlay(add4,add,'用户注册');
				return
			}
		})
	};
function videoPlay(videoUrl,flashplayerUrl,tit){
	var _html = '<script type="text/javascript">'
		+'var swfVersionStr = "10.2.0";'
		+'var xiSwfUrlStr = "playerProductInstall.swf";'
		+'var flashvars = {};'
		+'flashvars.url = "'+videoUrl+'";'
		+'flashvars.autoPlay = "true";'
		+'var params = {};'
		+'params.quality = "high";'
		+'params.bgcolor = "#666666";'
		+'params.wmode = "transparent";'
		+'params.allowscriptaccess = "sameDomain";'
		+'params.allowfullscreen = "true";'
		+'var attributes = {};'
		+'attributes.id = "EncryptPlayer";'
		+'attributes.name = "EncryptPlayer";'
		+'attributes.align = "middle";'
		+'swfobject.embedSWF("'+flashplayerUrl+'", "flashContent", "800px", "450px", swfVersionStr, xiSwfUrlStr, flashvars, params, attributes);'
		+'swfobject.createCSS("#flashContent", "display:block;text-align:left;");'
			+'<\/script>';

			 _html +=   '<div class="player_live">'
						+'<div id="VideoPlay" style="width:800px;height:450px">'
								+'<div class="lyrics-con-video" id="flashContent">'
										+'<script type="text/javascript">'
												+'var pageHost = ((document.location.protocol == "https:") ? "https://" :	"http://"); '
												+'document.write("<a href=\'http://www.adobe.com/go/getflashplayer\'><img src=\'" + pageHost + "www.adobe.com/images/shared/download_buttons/get_flash_player.gif\' alt=\'Get Adobe Flash player\' /></a>" ); '
										+'<\/script>'
								+'<\/div>'
						+'<\/div>'
				+'<\/div>';
			xue.win({
				content : _html,
				submit : false,
				cancel : false,
				width  : 800,
				height : 450,
				title : tit||'我与学而思网校'     
        })
		};




$(function(){
	xue.feedback.append();
	if(xue.feedback.isLowResolution()){
		jQuery('.qrcode').remove();
	}
	if(xue.feedback.isGuideExist()){
		rightGuide();
	}
	// 乐语 打码监听添加
	$('body').on('click', '#doyoo_panel', function(event) {
		utrack('xueersi.com','key=mainpage&value=leyu');
	});
	// var feedback_tpl = '<div class="rightResearch" id="FeedBack">'
	// 				+'		<ul>'
	// 				+'			<li><a id="r_copyright" href="http://bbs.xueersi.com/thread-280270-1-1.html" target="_blank"></a></li>'
	// 				+'			<li><a id="r_feedBack" target="_blank" href="http://www.xueersi.com/Help/feedback"></a></li>'
	// 				+'			<li><a id="r_toTop" href="javascript:scroll(0,0);" style="display:none;"></a></li>'
	// 				+'			<li id="copy_notice">'

	// 				// +'				<p class="p2">我爱学而思网校</p>'
	// 				+'			</li>'
	// 				+'		</ul>'
	// 				+'	</div>';

	
	// $('body').append(feedback_tpl);

	
	// $('#r_copyright').on('mouseenter', function(){
	// 	var that = $(this);
	// 	// xue.log($('#FeedBack').position().top);
	// 	$.ajax('/index/ajaxGetQqGroupInfo', {
	// 		type: 'post',
	// 		dataType: 'json',
	// 		success : function(v){
	// 			if(v.sign > 0){
	// 				var tpl ='<p class="group_name">'+ v.msg.group_name + '</p>'
	// 						+'<p class="group_num copy_notice_num">'+ v.msg.group_num +'</p>'
	// 						+'<p class="group_verify">验证信息“'+ v.msg.verify_content + '”</p>';
	// 				$('#copy_notice').html(tpl);
	// 				// var _top = xue.isIE6 ? 0 : $('#FeedBack').position().top;
	// 				$('#copy_notice').show();
	// 				// $('#copy_notice').show().css({
	// 				// 	top : _top
	// 				// });
	// 			}
	// 		}
	// 	})
		
	// 	$(this).on('mouseleave', function(e){
	// 		var tar = e.relatedTarget;
	// 		if(tar.id == 'copy_notice' || $(tar).parents('#copy_notice').length > 0){
	// 			that.addClass('current');
	// 			$('#copy_notice').on('mouseleave', function(){
	// 				$(this).hide();
	// 				that.removeClass('current');
	// 			});
	// 		}else{
	// 			$('#copy_notice').hide();
	// 			that.removeClass('current');
	// 		}
	// 	});
	// });
	// $(window).scroll(function(){
	// 	var _scrollTop = $(window).scrollTop();
	// 	if(_scrollTop > $(window).height()){
	// 		$('#r_toTop').show();	
	// 	}else{
	// 		$('#r_toTop').hide();
	// 	}
	// });		   
});