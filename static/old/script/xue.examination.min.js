/**
 * XESUI 
 * Copyright 2013 xueersi.com All rights reserved.
 *
 * @description 
 *
 * @author Marco (marco@xesui.com)
 * @modify 2013-07-08 16:51:28
 * @version $Id$
 * 
 * @links http://xesui.com
 */


/**
 * @name ui.examination.js
 * @description 这里是：考试、试卷、错题本的内容
 * 
 * @module 
 * @submodule 
 * @main 
 * @class 
 * @constructor 
 * @static 
 */

/**
 * 弹窗做题时的结构：
 *
    <p class="answer" data-id="1" data-type="input">
        <input />
    </p>
    var ans = $('.answer');
    
    ans.each(function(i){
        $(this).data({
            id:i,
            type:'input'
        });
    });
    xue.use('examination', function(){
    var a = xue.getAnswers('.sub_answer:visible');
    });
 *
 *
 *
 * 
 */

xue.getAnswers = function( wrap , tp){
    var box = $(wrap);
    if(box.length == 0){ return false; }

    var list = box.find('.answer:visible');

    // var error = [], answers = {}, obj = { /*isall: false, answer: {} */};
    var error = [], answers = {}, obj = {};

    list.each(function(){
        var that = $(this), 
            data = that.data(),
            id = data.id,
            tp = data.type,
            input = null,
            vals = [];

        if(tp == 'radio' || tp == 'checkbox'){
            input = that.find('a.current');
            if(input.length > 0){
                input.each(function(){
                    vals.push($(this).data('value'));
                });
            }else{
                error.push(that);
            }
        }else if( tp == 'input' ){
            input = that.find('input');
            input.each(function(){
                var v = $.trim($(this).val());
                if(v){
                    vals.push(v);
                }else{
                    if(v == ''){
                        vals.push('');
                    }
                    error.push(that);
                }
            });
        }
        answers[id] = vals;
    });

    obj.isall = error.length > 0 ? false : true;
    obj.answer = xue.JSON.stringify(answers);
    var data = null, vals = null, tp = null, input = null, error = null, 
        answers = null;

    return obj;
};

$(function(){
    // 试题中单选/多选绑定点击事件
    $('body').off('click', '.answer a').on('click', '.answer a', function(){
        var that = $(this);
        if(that.length > 0){
            var tp = that.data('type');
            // 单选的时候只是移出其他的未选的current
            // 多选的时候如果已选则移出
            if(tp == 'radio'){
                that.addClass('current').siblings('a').removeClass('current');
            }else if(tp == 'checkbox'){
                if(that.hasClass('current')){
                    that.removeClass('current');
                }else{
                    that.addClass('current');
                }
            }
        }
    });

    
});